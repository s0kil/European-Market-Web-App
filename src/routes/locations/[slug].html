<script context="module">
  /*
  function generateSchema(location) {
    return `
    "@context": "https://schema.org",
        "@type": "Restaurant",
        "image": [
          "https://example.com/photos/1x1/photo.jpg",
          "https://example.com/photos/4x3/photo.jpg",
          "https://example.com/photos/16x9/photo.jpg"
        ],
        "@id": "https://europeanmarketus.com",
        "name": "European Market",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "148 W 51st St",
          "addressLocality": "New York",
          "addressRegion": "NY",
          "postalCode": "10019",
          "addressCountry": "US"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 40.761293,
          "longitude": -73.982294
        },
        "url": "https://europeanmarketus.com/locations/${location.pageURL}",
        "telephone": "+12122459600",
        "servesCuisine": "American",
        "priceRange": "$$$",
        "openingHoursSpecification": [{
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": [
              "Monday",
              "Tuesday"
            ],
            "opens": "11:30",
            "closes": "22:00"
          },
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": [
              "Wednesday",
              "Thursday",
              "Friday"
            ],
            "opens": "11:30",
            "closes": "23:00"
          },
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": "Saturday",
            "opens": "16:00",
            "closes": "23:00"
          },
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": "Sunday",
            "opens": "16:00",
            "closes": "22:00"
          }
        ]
      }
    `
  }
  */

  export async function preload({params, query}) {
    const res = await this.fetch(`locations/${params.slug}.json`);
    const data = await res.json();

    if (res.status === 200) {
      /*
      return {
        location: {
          ...data,
          schema: generateSchema(data)
        }
      };
      */
      return {
        location: data
      };
    } else {
      this.error(res.status, data.message);
    }
  }
</script>

<script>
  import loadAsset from "loadjs";
  import {
    onMount
  } from "svelte";

  export let location;

  /*
  let script = document.createElement('script');
  script.type = 'application/ld+json';
  script.innerHTML = JSON.stringify(location.schema);
  document.head.appendChild(script);
  */

  onMount(() => {
    if (!loadAsset.isDefined("modestMaps")) {
      loadAsset(
        "https://cdn.jsdelivr.net/gh/modestmaps/modestmaps-js@3.3.6/modestmaps.min.js",
        "modestMaps"
      );
    }

    loadAsset.ready("modestMaps", () => {
      const mapBoxAccessToken = "pk.eyJ1IjoiZGFuaWVsc29raWwiLCJhIjoiY2s0NDZjaTFmMDh6ajNrbW1mb3h4cjJobiJ9.AcOfKPFXipCVNgaxZ66WTg";
      let provider = new MM.TemplatedLayer(
        "https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{Z}/{X}/{Y}?access_token=" + mapBoxAccessToken
      );

      let map = new MM.Map("map", provider);

      map.setZoom(16).setCenter({
        lat: location.coordinates.latitude,
        lon: location.coordinates.longitude
      });
    });
  });
</script>

<style>
  #map {
    background: white;


    width: 100%;
    height: calc(100vh - 110px);

    position: absolute;
    top: 0;
    left: 0;

    z-index: -1;
  }

  .location {
    position: relative;

    padding: 1rem;

    --bg-color: rgba(255, 255, 255, 0.8);
    background: linear-gradient(var(--bg-color), var(--bg-color));
  }

  .location h1 {
    font-family: "Merriweather", serif;
    color: #9a1915;
  }

  .location p {
    font-family: "Lato", sans-serif;
    font-size: 1.2rem;
    color: #202020;
  }

  .location a {
    color: #202020;
    text-decoration-color: #9a1915;
  }

  @media (max-width: 400px) {
    .location h1 {
      font-size: 1.2rem;
    }

    .location p {
      font-size: 1rem;
    }
  }
</style>

<svelte:head>
  <title>{location.location} | European Market</title>
</svelte:head>

<section class="location">
  <h1>European Market {location.location}</h1>

  <p>{location.hoursOfOperation}</p>

  <a target="_blank" href="https://www.google.com/maps/place/{location.address}">
    <p>{location.address}</p>
  </a>

  <a href="mailto:{location.emailAddress}">
    <p>{location.emailAddress}</p>
  </a>

  <a href="tel:{location.phoneNumber}">
    <p>{location.phoneNumber}</p>
  </a>

  <div id="map"></div>
</section>
